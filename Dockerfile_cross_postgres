FROM scratch as base
COPY ./static/ /app/static
COPY ./migrations /app/migrations
COPY ./db /app/db
WORKDIR /app/

FROM base as amd64


COPY ./target/x86/release/podfetch /app/podfetch

FROM base as armv7


COPY ./target/armv7/release/podfetch /app/podfetch

FROM base as arm64

COPY ./target/arm64/release/podfetch /app/podfetch

FROM ${TARGETARCH}${TARGETVARIANT} as final


EXPOSE 8000
CMD ["./podfetch"]